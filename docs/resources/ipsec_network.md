---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "cloudconnexa_ipsec_network Resource - terraform-provider-cloudconnexa"
subcategory: ""
description: |-
  Use cloudconnexa_ipsec_network resource to create and manage IPsec site-to-site VPN networks in CloudConnexa.
---

# cloudconnexa_ipsec_network (Resource)

Use `cloudconnexa_ipsec_network` resource to create and manage IPsec site-to-site VPN networks in CloudConnexa. This resource allows you to establish secure connections between your CloudConnexa organization and remote networks using IPsec tunnels.

## Example Usage

### Basic IPsec Network

```terraform
resource "cloudconnexa_ipsec_network" "example" {
  name        = "Branch Office VPN"
  description = "IPsec connection to branch office"

  egress          = true
  internet_access = false

  ipsec_config {
    remote_gateway = "203.0.113.1"
    remote_networks = [
      "192.168.1.0/24",
      "192.168.2.0/24"
    ]

    pre_shared_key = var.ipsec_psk
    ike_version    = "IKEv2"

    encryption_algorithm = "AES256"
    hash_algorithm      = "SHA256"
    dh_group           = "14"
    pfs_group          = "14"

    ike_lifetime    = 28800
    ipsec_lifetime  = 3600

    nat_traversal = true
  }

  connector {
    name        = "Branch Office Connector"
    description = "Connector for branch office IPsec tunnel"
    vpn_region_id = data.cloudconnexa_vpn_region.us_east.id
  }
}
```

### High Security IPsec Configuration

```terraform
resource "cloudconnexa_ipsec_network" "high_security" {
  name        = "High Security Site"
  description = "IPsec connection with enhanced security settings"

  egress          = true
  internet_access = false

  ipsec_config {
    remote_gateway = "198.51.100.1"
    remote_networks = [
      "10.0.0.0/16"
    ]

    pre_shared_key = var.high_security_psk
    ike_version    = "IKEv2"

    encryption_algorithm = "AES256"
    hash_algorithm      = "SHA512"
    dh_group           = "21"
    pfs_group          = "21"

    ike_lifetime    = 14400  # 4 hours
    ipsec_lifetime  = 1800   # 30 minutes

    nat_traversal = false
    dead_peer_detection = true
    dpd_interval = 30
    dpd_timeout  = 120
  }

  connector {
    name        = "High Security Connector"
    description = "High security IPsec connector"
    vpn_region_id = data.cloudconnexa_vpn_region.us_west.id
  }
}
```

### AWS VPC Integration

```terraform
resource "cloudconnexa_ipsec_network" "aws_vpc" {
  name        = "AWS VPC Connection"
  description = "IPsec tunnel to AWS VPC"

  egress          = true
  internet_access = false

  ipsec_config {
    remote_gateway = aws_vpn_connection.main.tunnel1_address
    remote_networks = [
      aws_vpc.main.cidr_block
    ]

    pre_shared_key = aws_vpn_connection.main.tunnel1_preshared_key
    ike_version    = "IKEv1"  # AWS VPN Gateway default

    encryption_algorithm = "AES128"
    hash_algorithm      = "SHA1"
    dh_group           = "2"
    pfs_group          = "2"

    ike_lifetime    = 28800
    ipsec_lifetime  = 3600

    nat_traversal = true
  }

  connector {
    name        = "AWS VPC Connector"
    description = "Connector for AWS VPC integration"
    vpn_region_id = data.cloudconnexa_vpn_region.us_east.id
  }
}
```

### Multi-Site Configuration

```terraform
variable "branch_offices" {
  description = "Branch office configurations"
  type = map(object({
    gateway_ip      = string
    networks        = list(string)
    pre_shared_key  = string
    vpn_region_id   = string
  }))
  default = {
    "new-york" = {
      gateway_ip     = "203.0.113.10"
      networks       = ["192.168.10.0/24"]
      pre_shared_key = "ny-branch-psk"
      vpn_region_id  = "us-east-1"
    }
    "los-angeles" = {
      gateway_ip     = "203.0.113.20"
      networks       = ["192.168.20.0/24"]
      pre_shared_key = "la-branch-psk"
      vpn_region_id  = "us-west-1"
    }
  }
}

resource "cloudconnexa_ipsec_network" "branch_offices" {
  for_each = var.branch_offices

  name        = "Branch Office - ${title(each.key)}"
  description = "IPsec connection to ${each.key} branch office"

  egress          = true
  internet_access = false

  ipsec_config {
    remote_gateway  = each.value.gateway_ip
    remote_networks = each.value.networks

    pre_shared_key = each.value.pre_shared_key
    ike_version    = "IKEv2"

    encryption_algorithm = "AES256"
    hash_algorithm      = "SHA256"
    dh_group           = "14"
    pfs_group          = "14"

    ike_lifetime   = 28800
    ipsec_lifetime = 3600

    nat_traversal = true
  }

  connector {
    name          = "${title(each.key)} Connector"
    description   = "Connector for ${each.key} branch office"
    vpn_region_id = each.value.vpn_region_id
  }
}
```

## Schema

### Required

- `name` (String) The name of the IPsec network.
- `ipsec_config` (Block, Required) IPsec tunnel configuration. (see [below for nested schema](#nestedblock--ipsec_config))
- `connector` (Block, Required) Network connector configuration for the IPsec network. (see [below for nested schema](#nestedblock--connector))

### Optional

- `description` (String) A description of the IPsec network.
- `egress` (Boolean) Whether the network allows egress traffic. Default: `true`.
- `internet_access` (Boolean) Whether the network allows internet access. Default: `false`.

### Read-Only

- `id` (String) The ID of the IPsec network.
- `network_item_id` (String) The network item ID associated with this IPsec network.
- `network_item_type` (String) The type of network item (always "NETWORK" for IPsec networks).

<a id="nestedblock--ipsec_config"></a>

### Nested Schema for `ipsec_config`

Required:

- `remote_gateway` (String) The IP address of the remote IPsec gateway.
- `remote_networks` (List of String) List of remote network CIDR blocks accessible through this IPsec tunnel.
- `pre_shared_key` (String, Sensitive) The pre-shared key for IPsec authentication.

Optional:

- `ike_version` (String) The IKE version to use. Valid values: `IKEv1`, `IKEv2`. Default: `IKEv2`.
- `encryption_algorithm` (String) The encryption algorithm for IPsec. Valid values: `AES128`, `AES256`, `3DES`. Default: `AES256`.
- `hash_algorithm` (String) The hash algorithm for IPsec. Valid values: `SHA1`, `SHA256`, `SHA384`, `SHA512`, `MD5`. Default: `SHA256`.
- `dh_group` (String) The Diffie-Hellman group for IKE. Valid values: `1`, `2`, `5`, `14`, `15`, `16`, `17`, `18`, `19`, `20`, `21`. Default: `14`.
- `pfs_group` (String) The Perfect Forward Secrecy group for IPsec. Valid values: `1`, `2`, `5`, `14`, `15`, `16`, `17`, `18`, `19`, `20`, `21`. Default: `14`.
- `ike_lifetime` (Number) The IKE SA lifetime in seconds. Default: `28800` (8 hours).
- `ipsec_lifetime` (Number) The IPsec SA lifetime in seconds. Default: `3600` (1 hour).
- `nat_traversal` (Boolean) Whether to enable NAT traversal (NAT-T). Default: `true`.
- `dead_peer_detection` (Boolean) Whether to enable Dead Peer Detection (DPD). Default: `true`.
- `dpd_interval` (Number) The DPD interval in seconds. Default: `30`.
- `dpd_timeout` (Number) The DPD timeout in seconds. Default: `120`.

Read-Only:

- `tunnel_status` (String) The current status of the IPsec tunnel.
- `local_gateway` (String) The local gateway IP address assigned by CloudConnexa.

<a id="nestedblock--connector"></a>

### Nested Schema for `connector`

Required:

- `name` (String) The name of the network connector.
- `vpn_region_id` (String) The ID of the VPN region where the connector will be deployed.

Optional:

- `description` (String) A description of the network connector.

Read-Only:

- `id` (String) The ID of the network connector.
- `network_item_id` (String) The network item ID associated with this connector.
- `network_item_type` (String) The type of network item.

## Import

IPsec networks can be imported using their ID:

```shell
terraform import cloudconnexa_ipsec_network.example ipsec-network-id
```

## Notes

### IPsec Configuration Guidelines

1. **IKE Version**:

   - Use `IKEv2` for modern deployments (recommended)
   - Use `IKEv1` for compatibility with older systems or cloud providers like AWS VPN Gateway

2. **Encryption Algorithms**:

   - `AES256`: Recommended for high security
   - `AES128`: Good balance of security and performance
   - `3DES`: Legacy support only, not recommended for new deployments

3. **Hash Algorithms**:

   - `SHA256` or higher: Recommended for new deployments
   - `SHA1`: Legacy support, acceptable for compatibility
   - `MD5`: Not recommended, use only if required for legacy systems

4. **Diffie-Hellman Groups**:

   - Groups 14, 15, 16: Recommended for new deployments
   - Groups 19, 20, 21: Elliptic curve groups for enhanced security
   - Groups 1, 2, 5: Legacy support only

5. **Lifetime Settings**:
   - Shorter lifetimes provide better security but may impact performance
   - Longer lifetimes reduce overhead but may be less secure
   - Balance based on your security requirements and network performance needs

### Troubleshooting

- Ensure that the remote gateway is reachable from the CloudConnexa region
- Verify that firewall rules allow IPsec traffic (UDP 500, UDP 4500, ESP protocol)
- Check that the pre-shared key matches on both sides
- Confirm that the IPsec parameters (algorithms, groups, lifetimes) are compatible
- Monitor the tunnel status through the CloudConnexa console or API
